}
>>>>>>> e879439788da385607dad24ca553ec532ab8a511
dat<-read.table(file="pop.csv",header=T)
head(dat,5)
which(!(min(dat$ID):max(dat$ID)%in%dat$ID))
alive<-subset(dat,phi==1)
levels(alive$phi)
summary(alive$phi)
summary(dat$5)
summary(dat$phi)
aggregate(alive$z,by=alive$t,mean)
aggregate(alive$z,by=list(alive$t),mean)
plot(means[,1],means[,2])
means<-aggregate(alive$z,by=list(alive$t),mean)
plot(means[,1],means[,2])
plot(means[,1],means[,2],type="l",xlab="t",ylab="mean Z")
cov
mycov<-function(x,y){
mean(x*y)-mean(x)*mean(y)
}
sum(dat$phi==0 & dat$ARS>0)
dat[dat$phi==0 & dat$ARS>0,]
dat[dat$ID==3,]
dat[dat$ID==5,]
alive<-subset(dat,phi==1 & sex=='f') # We take only the alive individuals
alive<-subset(dat,phi==1 & s=='F') # We take only the alive individuals
means<-aggregate(alive$z,by=list(alive$t),mean)
plot(means[,1],means[,2],type="l",xlab="t",ylab="$\\overline{Z}$")
range<-1:(length(means[,1])-1)
plot(means[range,1],means[(range+1),2]-means[range,2],type="l",ylab="$\\Delta \\overline{Z}$",xlab="t")
abline(h=0,col="gray")
head(dat,10)
dat[dat$p2==3,]
dat[dat$p1==3,]
alive$zoffs<-NA
for(t in 1:(max(alive$t)-1)){
for(i in levels(factor(dat$ID[dat$t==t]))){
alive$zoffs[dat$t==t & dat$ID==i]<-mean(dat$z[dat$p2==i & dat$age==0 & dat$t==t],na.rm=T)
}
}
head(alive)
for(t in 1:(max(alive$t)-1)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[dat$t==t & dat$ID==i]<-mean(dat$z[dat$p2==i & dat$age==0 & dat$t==t],na.rm=T)
}
}
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[dat$t==t && dat$ID==i]<-mean(dat$z[dat$p2==i && dat$age==0 && dat$t==t],na.rm=T)
}
}
head(alive)
dat<-read.table(file="pop.csv",header=T)
alive<-subset(dat,phi==1 & s=='F') # We take only the alive individuals
alive$zoffs<-NA
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[alive$t==t && alive$ID==i]<-mean(alive$z[dat$p2==i && alive$age==0 && alive$t==t],na.rm=T)
}
}
head(alive)
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[alive$t==t && alive$ID==i]<-mean(alive$z[dat$p1==i && alive$age==0 && alive$t==t],na.rm=T)
}
}
head(alive)
alive<-subset(dat,phi==1 & s=='F') # We take only the alive individuals
alive$zoffs<-NA
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[alive$t==t && alive$ID==i]<-mean(alive$z[alive$p1==i && alive$age==0 && alive$t==t],na.rm=T)
}
}
head(alive)
sum(alive$age==0)
sum(alive$p1==3)
sum(alive$p1==3,na.rm=T)
alive$z[alive$p1==3]
alive$z[alive$p1==3 && alive$age==0]
alive$z[(alive$p1==3 && alive$age==0)]
alive$z[(alive$p1==3 & alive$age==0)]
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[alive$t==t && alive$ID==i]<-mean(alive$z[alive$p1==i & alive$age==0 & alive$t==t],na.rm=T)
}
}
head(alive)
for(t in 1:max(alive$t)){
for(i in levels(factor(dat$ID[dat$t==t]))){
cat(i)
alive$zoffs[alive$t==t & alive$ID==i]<-mean(alive$z[alive$p1==i & alive$age==0 & alive$t==t],na.rm=T)
}
}
head(alive)
sumarry(alive$zoffs)
summarry(alive$zoffs)
summary(alive$zoffs)
length(alive$zoffs)
alive[alive$p1==11,]
alive[alive$p1==12,]
for(i in 1:length(alive$t)){
alive$zoffs[i]<-mean(alive$z[alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i]],na.rm=T)
}
head(alive)
alive[alive$ID==3]
alive[alive$ID==3,]
dat[dat$ID==3,]
dat[dat$ID==12,]
alive[alive$ID==12,]
alive[alive$p1==12,]
alive$z[alive$p1==12 & alive$age==0 & alive$t==2,]
alive$z[alive$p1==12 & alive$age==0 & alive$t==2]
mean(alive$z[alive$p1==12 & alive$age==0 & alive$t==2])
length(alive$t)
for(i in 1:length(alive$t)){
alive$zoffs[i]<-mean(alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])],na.rm=T)
}
head(alive)
alive[1,]
alive[2,]
i=5
alive$zoffs[i]<-mean(alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])],na.rm=T)
head(alive)
alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])]
alive$t[i]
head(alive,10)
head(alive,30)
alive[alive$ID==12,]
alive[alive$p1==12,]
dat[dat$p1==12,]
?length
length(c(1,2,3,NA))
length(c(1,2,3,NA),na.rm=T)
alive$zoffs<-NA
for(i in 1:length(alive$t)){
vals<-alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])]
alive$zoffs[i]<-mean(vals,na.rm=T)
alive$offs[i]<-length(vals[!is.na(vals)])
}
head(alive)
alive[alive$ID==12,]
alive[alive$p1==12,]
alive[alive$p1==54,]
alive[alive$p2==54,]
a<-numeric(100)
a
alive$g<-0
alive$su<-0
for(i in 1:length(alive$t)){
vals<-alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])]
alive$zoffs[i]<-mean(vals,na.rm=T)
alive$offs[i]<-length(vals[!is.na(vals)])
if(sum(alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1))){
alive$su[i]<-1
alive$g[i]<-alive$z[alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1)]-alive$z[i]
}
}
head(alive)
alive[alive$ID==3,]
alive[alive$ID==5,]
alive[alive$ID==8,]
alive[alive$ID==12,]
13.034-12.074
temp<-subset(alive,t==t)
t=2
temp<-subset(alive,t==t)
temp
temp<-subset(alive,alive$t==t)
temp
t
alive$t==t
temp<-subset(alive,alive$t==t)
temp
temp<-subset(alive,alive$t==time)
time<-2
temp<-subset(alive,alive$t==time)
temp
Ntp1<-length(alive$t[alive$t==time+1])
Ntp1
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZs[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$zoffs-temp$z,na.rm=T)
covDR[i]<-mycov(temp$zoffs-temp$z,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZs[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$zoffs-temp$z,na.rm=T)
covDR[i]<-mycov(temp$zoffs-temp$z,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$zoffs-temp$z,na.rm=T)
covDR[i]<-mycov(temp$zoffs-temp$z,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
covZR
covDR
Dbar
Rbar
Wbar
live<-subset(dat,phi==1 & s=='F') # We take only the alive individuals
alive$zoffs<-NA
alive$g<-0
alive$su<-0
for(i in 1:length(alive$t)){
vals<-alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==alive$t[i])]
alive$zoffs[i]<-mean(vals,na.rm=T)
alive$offs[i]<-length(vals[!is.na(vals)])
if(sum(alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1))){
alive$su[i]<-1
alive$g[i]<-alive$z[alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1)]-alive$z[i]
}
}
alive$D<-alive$zoffs-alive$z
alive$D[is.na(alive$D)]<-0
means<-aggregate(alive$z,by=list(alive$t),mean)
plot(means[,1],means[,2],type="l",xlab="t",ylab="$\\overline{Z}$")
range<-1:(length(means[,1])-1)
plot(means[range,1],means[(range+1),2]-means[range,2],type="l",ylab="$\\Delta \\overline{Z}$",xlab="t")
abline(h=0,col="gray")
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
)
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
Dbar
covDR
overall<-(1/Wbar)*Zbar*Sbar-Zbar+(1/Wbar)*(covZS+SGbar)+(1/Wbar)*(Rbar*Dbar+Zbar*Rbar+covDR+covZR)
means[(range+1),2]-means[range,2]
overall
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
overall<-(1/Wbar)*Zbar*Sbar-Zbar+(1/Wbar)*(covZS+SGbar)+(1/Wbar)*(Rbar*Dbar+Zbar*Rbar+covDR+covZR)
overall
ZSbar[i]<-numeric(to-from+1)
RDbar[i]<-numeric(to-from+1)
ZRbar[i]<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
ZSbar[i]<-mean(temp$z*temp$su)
RDbar[i]<-mean(temp$R*temp$D)
ZRbar[i]<-mean(temp$z*temp$R)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
Ztp1<-(1/Wbar)*(ZSbar+SGbar+RDbar+ZRbar)
ZSbar<-numeric(to-from+1)
RDbar<-numeric(to-from+1)
ZRbar<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
ZSbar[i]<-mean(temp$z*temp$su)
RDbar[i]<-mean(temp$R*temp$D)
ZRbar[i]<-mean(temp$z*temp$R)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
Ztp1<-(1/Wbar)*(ZSbar+SGbar+RDbar+ZRbar)
Ztp1
ZSbar
SGbar
RDbar
ZRbar
summary(alive$D)
Dbar
covDR
RDbar
sum(alive$R*alive$D)
mean(alive$R*alive$D)
head(alive$R)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
ZSbar[i]<-mean(temp$z*temp$su)
RDbar[i]<-mean(temp$offs*temp$D)
ZRbar[i]<-mean(temp$z*temp$offs)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
Ztp1<-(1/Wbar)*(ZSbar+SGbar+RDbar+ZRbar)
Ztp1
means
ztp1
Ztp1
means[,2]
Ztp1<-(1/Wbar)*(ZSbar+SGbar-RDbar+ZRbar)
Ztp1
Ztp1<-(1/Wbar)*(ZSbar-SGbar+RDbar+ZRbar)
Ztp1
alive<-subset(dat,phi==1 & s=='F') # We take only the alive individuals
alive$zoffs<-NA
alive$g<-0
alive$su<-0
for(i in 1:length(alive$t)){
vals<-alive$z[(alive$p1==alive$ID[i] & alive$age==0 & alive$t==(alive$t[i])+1)]
alive$zoffs[i]<-mean(vals,na.rm=T)
alive$offs[i]<-length(vals[!is.na(vals)])
if(sum(alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1))){
alive$su[i]<-1
alive$g[i]<-alive$z[alive$ID==alive$ID[i] & alive$t==(alive$t[i]+1)]-alive$z[i]
}
}
alive$D<-alive$zoffs-alive$z
alive$D[is.na(alive$D)]<-0
means<-aggregate(alive$z,by=list(alive$t),mean)
plot(means[,1],means[,2],type="l",xlab="t",ylab="$\\overline{Z}$")
range<-1:(length(means[,1])-1)
plot(means[range,1],means[(range+1),2]-means[range,2],type="l",ylab="$\\Delta \\overline{Z}$",xlab="t")
abline(h=0,col="gray")
from<-min(alive$t)
to<-max(alive$t)-1
#the terms:
Wbar<-numeric(to-from+1)
Zbar<-numeric(to-from+1)
Sbar<-numeric(to-from+1)
covZS<-numeric(to-from+1)
SGbar<-numeric(to-from+1)
Rbar<-numeric(to-from+1)
Dbar<-numeric(to-from+1)
covDR<-numeric(to-from+1)
covZR<-numeric(to-from+1)
ZSbar<-numeric(to-from+1)
RDbar<-numeric(to-from+1)
ZRbar<-numeric(to-from+1)
for(i in 1:(to-from+1)){
time<-(min(alive$t):(max(alive$t)-1))[i]
Ntp1<-length(alive$t[alive$t==time+1])
temp<-subset(alive,alive$t==time)
Wbar[i]<-Ntp1/length(temp$t)
Zbar[i]<-mean(temp$z)
Sbar[i]<-mean(temp$su)
covZS[i]<-mycov(temp$z,temp$su)
SGbar[i]<-mean(temp$su*temp$g)
ZSbar[i]<-mean(temp$z*temp$su)
RDbar[i]<-mean(temp$offs*temp$D)
ZRbar[i]<-mean(temp$z*temp$offs)
Rbar[i]<-mean(temp$offs)
Dbar[i]<-mean(temp$D)
covDR[i]<-mycov(temp$D,temp$offs)
covZR[i]<-mycov(temp$z,temp$offs)
}
Ztp1<-(1/Wbar)*(ZSbar+SGbar+RDbar+ZRbar)
overall<-(1/Wbar)*Zbar*Sbar-Zbar+(1/Wbar)*(covZS+SGbar)+(1/Wbar)*(Rbar*Dbar+Zbar*Rbar+covDR+covZR)
Ztp1
means[,2]
points(means[range,1],overall,col='red')
covDR
covDR/Wbar
covZR/Wbar
